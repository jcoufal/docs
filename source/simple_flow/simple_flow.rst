Simple Flow of RDO Deployment
=============================

With these few steps you will be able to simply deploy RDO to your environment
using our POC defaults in few steps.

Prepare Virtual Environment
---------------------------
See :ref:`virtual_env`.


Install RDO-Manager
-------------------
See :ref:`installation`.


Get Images
----------

You can simply download and use provided overcloud images to get started::

    # Save images URL location
    images_url="https://repos.fedorapeople.org/repos/openstack/rdo-manager/images/centos/"

    # Download and create kernel/ramdisk images
    openstack image create --name=overcloud-full-kernel --is-public=true --disk-format=aki --image-url="$images_url/overcloud-full.vmlinuz"
    openstack image create --name=overcloud-full-ramdisk --is-public=true --disk-format=ari --image-url="$images_url/overcloud-full.initdr"

    # Save kernel and ramdisk IDs
    kernel_id=$(openstack image show overcloud-full-kernel | grep ' id ' | awk '{print $4}')
    ramdisk_id=$(openstack image show overcloud-full-ramdisk | grep ' id ' | awk '{print $4}')

    # Download and create overcloud-full image
    openstack image create \
      --name=overcloud-full \
      --is-public=true \
      --disk-format=qcow2 \
      --container-format=bare \
      --property kernel_id=$kernel_id \
      --property ramdisk_id=$ramdisk_id \
      --image-url="$images_url/overcloud-full.qcow2"

    # You can check image list by `openstack image list`


Download and copy discovery images to proper place::

    sudo curl -O $(images_url + "discovery.kernel") /tftpboot/discovery.kernel
    sudo curl -O $(images_url + "discovery.initramfs") /tftpboot/discovery.ramdisk


.. note:: If you happen to need to build overcloud images anyway, please follow
   next `instack documentation <https://repos.fedorapeople.org/repos/openstack-m/instack-undercloud/html/build-images.html>`_.


Register and Discover Nodes
---------------------------
..
  Generate a nodes.json file from environment description generated by instack::

    jq '.nodes[].memory=null | .nodes[].disk=null | .nodes[].arch=null | .nodes[].cpu=null | .nodes' instackenv.json > nodes.json


Upload the file and register multiple nodes at once::

    openstack baremetal import --json nodes.json


Start discovery process of all nodes::

    openstack baremetal introspection all start


Check discovery process of all nodes::

    openstack baremetal introspection all status



Create Flavors (Node Profiles)
------------------------------

Create flavors for Control and Compute roles::

    openstack flavor create baremetal_control --id=auto --ram=2048 --disk=40 cpu=1
    openstack flavor create baremetal_compute --id=auto --ram=4096 --disk=40 cpu=1


Set extra values::

    openstack flavor set baremetal_control --cpu_arch=x86_64 --profile=control
    openstack flavor set baremetal_compute --cpu_arch=x86_64 --profile=compute


Deploy RDO
----------

::

    instack-deploy-overcloud
